ccm.component({name:"bugtrackerMwe",config:{html:[ccm.store,{local:"http://moritzkemp.github.io/bugtracker-mwe/resources/js/templates.json"}],remoteStore:[ccm.store,{store:"bugtracker",url:"http://ccm2.inf.h-brs.de/index.js"}],style:[ccm.load,"http://moritzkemp.github.io/bugtracker-mwe/resources/css/bug.css"],icons:[ccm.load,"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css"],inputData:{store:[ccm.store,"http://moritzkemp.github.io/bugtracker-mwe/resources/js/input.json"],key:"bugInput"}},Instance:function(){var t=this,e=0;t.init=function(e){ccm.instance("https://akless.github.io/ccm-components/resources/input/ccm.input.js",{data:t.inputData,fieldset:"Add bug",onFinish:function(t){var e=(new Date).getTime();t.bugId=e,t.key=e;var n=$.Event("newBug",{bug:t});$(".input-comp-area").trigger(n)}},function(e){t.inputComponent=e}),e&&e()},t.render=function(r){var i=ccm.helper.element(t),o=function(e){var r=$(ccm.helper.html(t.html.get("main"))),o=$(ccm.helper.html(t.html.get("header"),{bugIdTitle:"ID",priorityTitle:"Priority",nameTitle:"Title",statusTitle:"State",subscriberTitle:"Subscriber",descriptionTitle:"Description"}));o.appendTo(r),n(e);for(var c=0;e[c];){var s=$(ccm.helper.html(t.html.get("bug"),{bugId:e[c].bugId,priority:e[c].priority,subscriber:e[c].subscriber,description:e[c].description,status:e[c].state,name:e[c].name}));s.appendTo(r),c++}var u=$(ccm.helper.html(t.html.get("new-bug-btn")));u.appendTo(r),i.html(r)},c=function(){e=0===e?1:0,t.render()},s=function(){var e=$(this).parents(".bug").children(".bug-id").html();t.remoteStore.get(function(n){n.forEach(function(n){n.bugId!==e&&n.bugId.toString()!==e||t.removeBug(n)}),t.render()})},u=function(){var e=$(this).parents(".bug"),n=e.children(".bug-id").html(),r={};t.remoteStore.get(function(i){i.forEach(function(t){t.bugId!==n&&t.bugId.toString()!==n||(r=t)});var o=$(ccm.helper.html(t.html.get("bug-edit"),{bugId:r.bugId,priority:r.priority,subscriber:r.subscriber,description:r.description,name:r.name}));o.find(".fa-check").click(function(){r.state=o.find("#states").val(),r.description=o.find("#description-text").val(),t.remoteStore.set(r,function(){t.render()})}),o.find(".fa-trash").click(function(){t.render()}),e.replaceWith(o)})},a=function(){i.html($(ccm.helper.html(t.html.get("bug-input-container")))),ccm.helper.find(t,"#input-back-btn").click(function(){t.render()}),t.inputComponent.element=$(".input-comp-area"),t.inputComponent.render(),i.on("newBug",function(e){t.storeBug(e.bug),t.render()})};t.remoteStore.get(function(t){o(t),$(".new-bug-btn").click(this,a),$(".current-status-header").click(this,c),$(".bug-buttons > .fa-edit").click(this,u),$(".bug-buttons > .fa-remove").click(this,s)})},t.storeBug=function(e){t.remoteStore.set(e,function(t){console.log(t)})},t.removeBug=function(e){e.key?t.remoteStore.del(e.key,function(){console.log("Delete bug with key "+e.key)}):console.log("Bug not persisted yet. Skip delete request.")};var n=function(t){var n=function(t,e){return"open"===t.state||"closed"===e.state?-1:t.state===e.state?0:1},r=function(t,e){return-1*n(t,e)};0===e?($("#status-mark").removeClass("fa-sort-up"),$("#status-mark").addClass("fa-sort-down"),t.sort(n)):($("#status-mark").removeClass("fa-sort-down"),$("#status-mark").addClass("fa-sort-up"),t.sort(r))}}});